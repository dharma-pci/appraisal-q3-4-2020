<?xml version="1.0"?>
<odoo>

    <record id="add_crm_product_lines_view_form" model="ir.ui.view">
        <field name="name">add.crm.product.lines.view.form</field>
        <field name="model">crm.lead</field>
        <field name="priority">20</field>
        <field name="arch" type="xml">
            <form version="7.0" create="false">
                <sheet>
                    <h3 style="color: #7a12c5;">This wizard will allow you to add product lines for purchase.</h3>
                    <notebook>
	                    <page string="Product Lines">
		                    <field name="company_id" invisible="True"/>
		                    <field name="crm_products_ids">
		                        <tree editable="bottom">
		                            <field name="product_id"
		                                   domain="[('purchase_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"
		                                   options="{'no_quick_create': True, 'no_create_edit': True}"/>
		                            <field name="product_uom_category_id" invisible="1"/>
		                            <field name="request_qty"/>
		                            <field name="product_uom_id" options="{'no_quick_create': True, 'no_create_edit': True}"/>
		                            <field name="product_partner_ids" invisible="1"/>
		                            <field name="partner_ids" options="{'no_quick_create': True, 'no_create_edit': True}"
		                                   domain="[('id', 'in', product_partner_ids)]"
		                                   widget="many2many_tags"/>
		                        </tree>
		                    </field>
	                    </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

	<record id="view_crm_case_opportunities_filter" model="ir.ui.view">
	    <field name="name">crm.lead.search.opportunity</field>
	    <field name="model">crm.lead</field>
	    <field name="inherit_id" ref="crm.view_crm_case_opportunities_filter"/>
	    <field name="arch" type="xml">
	        <xpath expr="//field[@name='city']" position="after">
	            <field name="product_id"/>
	            <field name="line_partner_id"/>
	        </xpath>
	    </field>
	</record>

	<record id="crm_lead_view_form" model="ir.ui.view">
	    <field name="name">crm.lead.form</field>
	    <field name="model">crm.lead</field>
	    <field name="inherit_id" ref="crm.crm_lead_view_form"/>
	    <field name="arch" type="xml">
	        <xpath expr="//button[@name='action_schedule_meeting']" position="after">
				<button type="object" name="action_view_purchase_rfq" class="oe_stat_button"
				    icon="fa-pencil-square-o" attrs="{'invisible':[('purchase_count', '=', 0)]}">
				    <field name="purchase_count" widget="statinfo" string="of RFQ(s)"/>
				</button>
	        </xpath>
            <xpath expr="//header/button[@name='action_set_won_rainbowman']" position="before">
	            <button name="action_create_vendor_rfq" class="oe_highlight"
	                    string="Create Vendor RFQ" type="object"/>
                <button name="action_add_product_lines" class="oe_highlight"
                        context="{'button_add_product_line': True}"
                        string="Add Product Lines" type="object"/>
            </xpath>
	        <xpath expr="//page[@name='lead']" position="after">
	            <page name="request_products" string="Request Product to Vendor">
                    <field name="crm_products_ids">
					    <tree editable="bottom">
						    <field name="product_id" attrs="{'readonly': [('po_line_id', '!=', False)]}"
						           domain="[('purchase_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"
						           options="{'no_quick_create': True, 'no_create_edit': True}"/>
						    <field name="product_uom_category_id" invisible="1"/>
						    <field name="request_qty" attrs="{'readonly': [('po_line_id', '!=', False)]}"/>
						    <field name="product_uom_id" attrs="{'readonly': [('po_line_id', '!=', False)]}"
						           options="{'no_quick_create': True, 'no_create_edit': True}"/>
						    <field name="product_partner_ids" invisible="1"/>
						    <field name="line_partner_id" invisible="1"/>
						    <field name="price_unit" invisible="1"/>
						    <field name="partner_ids" attrs="{'readonly': [('po_line_id', '!=', False)]}"
						           options="{'no_quick_create': True, 'no_create_edit': True}"
						           domain="[('id', 'in', product_partner_ids)]"
						           widget="many2many_tags"/>
						    <field name="qty_available"/>
						    <field name="po_line_id" readonly="1"/>
						    <field name="po_id" readonly="1"/>
						</tree>
						<form>
                            <group>
                                <group>
                                    <field name="product_id"/>
                                    <field name="request_qty"/>
                                    <field name="product_uom_id" options="{'no_open': True}"/>
                                    <field name="product_uom_category_id" invisible="1"/>
                                </group>
                                <group>
                                    <field name="qty_available"/>
                                    <field name="partner_ids" widget="many2many_tags"/>
                                    <field name="po_line_id"/>
                                    <field name="po_id"/>
                                </group>
                            </group>
						</form>
                    </field>
	            </page>
	        </xpath>
	    </field>
	</record>

</odoo>
